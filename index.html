<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Code Engine</title>
<style>
body {
  margin:0;
  overflow:hidden;
  font-family: monospace;
  background:#1e1e1e;
}
#editor {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:40%;
  background:#1e1e1e;
  color:#d4d4d4;
  display:flex;
  flex-direction:column;
}
#toolbar {
  padding:6px;
  background:#333;
}
button {
  background:#0e639c;
  color:white;
  border:none;
  padding:5px 10px;
  margin-right:6px;
  cursor:pointer;
}
textarea {
  flex:1;
  background:#1e1e1e;
  color:#d4d4d4;
  border:none;
  resize:none;
  padding:10px;
  font-size:14px;
}
</style>
</head>
<body>

<div id="editor">
  <div id="toolbar">
    <button onclick="run()">â–¶ Run Script</button>
    <span>Language: JavaScript (Engine API)</span>
  </div>
  <textarea id="code">
// Example Engine Script

// Camera
camera.position.set(0, 5, 10);
camera.lookAt(0,0,0);

// Light
const light = new Light(10, 20, 10);

// Baseplate
const base = new Block(0, -0.5, 0, 20, 1, 20, 0x3a8f3a);

// Floating block
const box = new Block(0, 2, 0, 2, 2, 2, 0xff5555);
  </textarea>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
/* ========== ENGINE CORE ========== */

let scene, camera, renderer;

function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight * 0.6);
  document.body.appendChild(renderer.domElement);

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

/* ========== ENGINE API ========== */

class Block {
  constructor(x,y,z,w,h,d,color=0xffffff){
    const mesh = new THREE.Mesh(
      new THREE.BoxGeometry(w,h,d),
      new THREE.MeshStandardMaterial({color})
    );
    mesh.position.set(x,y,z);
    scene.add(mesh);
    return mesh;
  }
}

class Light {
  constructor(x,y,z){
    const a = new THREE.AmbientLight(0xffffff,0.6);
    const d = new THREE.DirectionalLight(0xffffff,1);
    d.position.set(x,y,z);
    scene.add(a);
    scene.add(d);
  }
}

/* ========== SCRIPT RUNNER ========== */

function run(){
  // Clear scene
  while(scene.children.length > 0){
    scene.remove(scene.children[0]);
  }

  try {
    new Function(document.getElementById("code").value)();
  } catch(e){
    alert("Script Error:\n" + e.message);
  }
}

init();
run();
</script>

</body>
</html>
