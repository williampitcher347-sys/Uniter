<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UNITER BY WILL</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}

/* TOP BAR */
#topbar{
 position:fixed;top:0;left:0;right:0;height:40px;
 background:#1b1b1b;color:white;
 display:flex;align-items:center;padding:0 10px;z-index:10
}
#topbar button{margin-right:8px}

/* LEFT WORKSPACE */
#workspacePanel{
 position:fixed;top:40px;left:0;width:220px;bottom:80px;
 background:#141414;color:white;padding:6px;overflow:auto
}
.item{padding:4px;cursor:pointer}
.item.sel{background:#2a7cff}

/* RIGHT SCRIPT */
#scriptPanel{
 position:fixed;top:40px;right:0;width:320px;bottom:80px;
 background:#141414;color:white;padding:6px
}
textarea{
 width:100%;height:100%;background:#0e0e0e;color:#0f0;
 border:1px solid #333;font-family:monospace;font-size:12px
}

/* BOTTOM BAR */
#bottombar{
 position:fixed;left:0;right:0;bottom:0;height:80px;
 background:#1b1b1b;color:white;
 display:flex;align-items:center;justify-content:center;gap:10px
}
.tool{padding:10px 14px;background:#333;cursor:pointer}
.tool.active{background:#2a7cff}

button{background:#2a7cff;border:0;color:white;padding:6px 10px;border-radius:4px}
</style>
</head>
<body>

<div id="topbar">
 <button onclick="play()">▶ Play</button>
 <button onclick="stop()">⏹ Stop</button>
</div>

<div id="workspacePanel">
 <b>Workspace</b>
 <div id="workspace"></div>
</div>

<div id="scriptPanel">
 <b>Script</b>
 <textarea id="code">
class Script{
 start(o){}
 update(o,dt){}
}
 </textarea>
</div>

<div id="bottombar">
 <div class="tool active" onclick="setTool('move')">Move</div>
 <div class="tool" onclick="setTool('rotate')">Rotate</div>
 <div class="tool" onclick="setTool('scale')">Scale</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
/* CORE */
const scene=new THREE.Scene();

/* SKYBOX */
scene.background=new THREE.CubeTextureLoader().load([
 "https://threejs.org/examples/textures/cube/skybox/px.jpg",
 "https://threejs.org/examples/textures/cube/skybox/nx.jpg",
 "https://threejs.org/examples/textures/cube/skybox/py.jpg",
 "https://threejs.org/examples/textures/cube/skybox/ny.jpg",
 "https://threejs.org/examples/textures/cube/skybox/pz.jpg",
 "https://threejs.org/examples/textures/cube/skybox/nz.jpg"
]);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1000);
camera.position.set(0,6,10);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

/* LIGHT */
const sun=new THREE.DirectionalLight(0xffffff,1.2);
sun.position.set(10,20,10);
sun.castShadow=true;
scene.add(sun);
scene.add(new THREE.AmbientLight(0x404040));

/* PLATFORM */
const platform=new THREE.Mesh(
 new THREE.BoxGeometry(40,1,40),
 new THREE.MeshStandardMaterial({color:0x2d2d2d})
);
platform.position.y=-0.5;
platform.receiveShadow=true;
scene.add(platform);

/* OBJECTS */
const objects=[];
let selected=null;
let tool="move";
let playing=false;

function addCube(){
 const mesh=new THREE.Mesh(
  new THREE.BoxGeometry(),
  new THREE.MeshStandardMaterial({color:Math.random()*0xffffff})
 );
 mesh.position.y=1;
 mesh.castShadow=true;
 scene.add(mesh);
 const o={mesh,script:null,code:"",started:false};
 objects.push(o);
 refresh();
}

/* DEFAULT OBJECT */
addCube();

/* WORKSPACE */
function refresh(){
 const w=document.getElementById("workspace");
 w.innerHTML="";
 objects.forEach(o=>{
  const d=document.createElement("div");
  d.className="item"+(o===selected?" sel":"");
  d.textContent="GameObject";
  d.onclick=()=>select(o);
  w.appendChild(d);
 });
}
function select(o){
 selected=o;
 document.getElementById("code").value=o.code||document.getElementById("code").value;
 refresh();
}

/* SCRIPT */
function applyScript(){
 if(!selected)return;
 const c=document.getElementById("code").value;
 const C=new Function(c+";return Script;")();
 selected.script=new C();
 selected.code=c;
 selected.started=false;
}

/* TOOLS */
function setTool(t){
 tool=t;
 document.querySelectorAll(".tool").forEach(e=>e.classList.remove("active"));
 event.target.classList.add("active");
}

/* MOVE TOOL */
let dragging=false;
addEventListener("mousedown",e=>{
 if(!selected||playing)return;
 dragging=true;
});
addEventListener("mouseup",()=>dragging=false);
addEventListener("mousemove",e=>{
 if(dragging&&tool==="move"&&!playing){
  selected.mesh.position.x+=e.movementX*0.02;
  selected.mesh.position.z-=e.movementY*0.02;
 }
});

/* PLAY MODE */
function play(){
 playing=true;
 applyScript();
 document.exitPointerLock();
}
function stop(){
 playing=false;
}

/* LOOP */
let last=performance.now();
(function loop(t){
 requestAnimationFrame(loop);
 const dt=(t-last)/1000;last=t;

 if(playing){
  objects.forEach(o=>{
   if(o.script){
    if(!o.started){o.script.start?.(o);o.started=true;}
    o.script.update?.(o,dt);
   }
  });
 }

 renderer.render(scene,camera);
})();
addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
